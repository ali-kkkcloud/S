<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 REAL-TIME Employee Management Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Real-time Indicator */
        .realtime-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #48bb78, #38a169);
            color: white;
            padding: 8px 0;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            z-index: 1002;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        /* Login Page */
        .login-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(45deg, #667eea, #764ba2);
            padding-top: 40px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 400px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .login-box h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .realtime-badge {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 11px;
            margin-bottom: 20px;
            display: inline-block;
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(72, 187, 120, 0.5); }
            50% { box-shadow: 0 0 20px rgba(72, 187, 120, 0.8); }
            100% { box-shadow: 0 0 5px rgba(72, 187, 120, 0.5); }
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-demo {
            background: linear-gradient(45deg, #48bb78, #38a169);
            font-size: 14px;
            padding: 10px 20px;
            margin: 5px;
            width: auto;
            display: inline-block;
        }

        /* Dashboard with Real-time Indicators */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: #f8fafc;
            padding-top: 40px;
        }

        .dashboard.show {
            display: block;
        }

        .header {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 5px solid #48bb78;
        }

        .header h1 {
            color: #2d3748;
            font-size: 24px;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: #48bb78;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #48bb78;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .logout-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c53030;
            transform: translateY(-1px);
        }

        /* Navigation with Real-time Badges */
        .nav-tabs {
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            overflow-x: auto;
        }

        .nav-tab {
            background: transparent;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #f7fafc;
        }

        .update-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e53e3e;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-left: 5px solid transparent;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .card.updated {
            border-left-color: #48bb78;
            animation: cardUpdate 2s ease-out;
        }

        @keyframes cardUpdate {
            0% { background: #e6fffa; }
            100% { background: white; }
        }

        .card h2, .card h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        /* Stats Cards with Live Updates */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-top: 4px solid #667eea;
        }

        .stat-card.updating {
            animation: statUpdate 1s ease-out;
        }

        @keyframes statUpdate {
            0% { transform: scale(1.05); background: #e6fffa; }
            100% { transform: scale(1); background: white; }
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
            font-weight: 600;
        }

        /* Status Badges with Animation */
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.3s;
        }

        .status-working { 
            background: #c6f6d5; 
            color: #22543d;
            animation: working 2s infinite;
        }

        @keyframes working {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .status-break { background: #fef5e7; color: #975a16; }
        .status-out { background: #fed7d7; color: #742a2a; }
        .status-present { background: #c6f6d5; color: #22543d; }
        .status-absent { background: #fed7d7; color: #742a2a; }

        /* Time Display with Live Updates */
        .time-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .time-item {
            background: #f7fafc;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .time-item.updating {
            background: #e6fffa;
            transform: scale(1.02);
        }

        .time-item h4 {
            color: #718096;
            font-size: 12px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .time-item span {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            flex: 1;
            min-width: 120px;
            font-size: 14px;
            padding: 10px;
            margin-bottom: 0;
        }

        .btn-success { 
            background: linear-gradient(45deg, #48bb78, #38a169);
        }
        .btn-danger { 
            background: linear-gradient(45deg, #e53e3e, #c53030);
        }
        .btn-warning { 
            background: linear-gradient(45deg, #ed8936, #dd6b20);
        }
        .btn-info {
            background: linear-gradient(45deg, #4299e1, #3182ce);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            margin: 2px;
            transition: all 0.3s;
        }

        .btn-small:hover {
            transform: translateY(-1px);
        }

        /* Task Items with Real-time Progress */
        .task-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .task-item {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
            background: white;
        }

        .task-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .task-item.updated {
            border-color: #48bb78;
            animation: taskUpdate 2s ease-out;
        }

        @keyframes taskUpdate {
            0% { background: #e6fffa; transform: scale(1.02); }
            100% { background: white; transform: scale(1); }
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .task-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .task-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #718096;
            flex-wrap: wrap;
            align-items: center;
        }

        .priority-urgent { color: #e53e3e; font-weight: bold; animation: urgent 1s infinite; }
        .priority-high { color: #e53e3e; font-weight: bold; }
        .priority-medium { color: #ed8936; font-weight: bold; }
        .priority-low { color: #48bb78; font-weight: bold; }

        @keyframes urgent {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Task Progress with Animation */
        .task-progress {
            margin: 10px 0;
        }

        .progress-bar {
            background: #e2e8f0;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #48bb78, #38a169);
            transition: width 0.5s ease-out;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }

        /* Checklist with Real-time Updates */
        .task-checklist {
            margin: 10px 0;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            margin: 5px 0;
            border-radius: 6px;
            transition: all 0.3s;
            background: #f7fafc;
        }

        .checklist-item:hover {
            background: #e6fffa;
        }

        .checklist-item.completed {
            background: #c6f6d5;
            animation: checkComplete 0.5s ease-out;
        }

        @keyframes checkComplete {
            0% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
            cursor: pointer;
        }

        /* Employee Cards with Live Status */
        .employee-card {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            transition: all 0.3s;
        }

        .employee-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .employee-card.new {
            border-color: #48bb78;
            animation: newEmployee 2s ease-out;
        }

        @keyframes newEmployee {
            0% { background: #e6fffa; transform: scale(1.02); }
            100% { background: white; transform: scale(1); }
        }

        .employee-info h4 {
            color: #2d3748;
            margin-bottom: 5px;
        }

        .employee-info p {
            color: #718096;
            font-size: 14px;
        }

        .employee-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Modal with Enhanced Design */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
            animation: modalShow 0.3s ease-out;
        }

        @keyframes modalShow {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalContentShow 0.3s ease-out;
        }

        @keyframes modalContentShow {
            0% { transform: scale(0.9) translateY(50px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #2d3748;
        }

        .close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close:hover {
            background: #f7fafc;
            transform: scale(1.1);
        }

        /* Form Styling */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-row .input-group {
            margin-bottom: 15px;
        }

        /* Notifications with Enhanced Animations */
        .notification {
            position: fixed;
            top: 60px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            z-index: 1001;
            display: none;
            max-width: 350px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        .notification.success { 
            background: linear-gradient(45deg, #48bb78, #38a169);
        }
        .notification.error { 
            background: linear-gradient(45deg, #e53e3e, #c53030);
        }
        .notification.info { 
            background: linear-gradient(45deg, #4299e1, #3182ce);
        }

        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Real-time Status Panel */
        .realtime-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 999;
            border-left: 4px solid #48bb78;
            min-width: 200px;
        }

        .realtime-status.active {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            animation: pulse 2s infinite;
        }

        .connection-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        /* Tables with Live Updates */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            transition: all 0.3s;
        }

        .data-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        .data-table tr.updated {
            background: #e6fffa;
            animation: rowUpdate 2s ease-out;
        }

        @keyframes rowUpdate {
            0% { background: #c6f6d5; }
            100% { background: #e6fffa; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container { 
                padding: 10px; 
            }
            
            .grid { 
                grid-template-columns: 1fr; 
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header { 
                flex-direction: column; 
                gap: 15px; 
                text-align: center; 
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .action-buttons { 
                flex-direction: column; 
            }
            
            .time-display { 
                grid-template-columns: repeat(2, 1fr);
            }
            
            .employee-card {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .modal-content {
                margin: 10px;
                width: calc(100% - 20px);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .realtime-status {
                bottom: 10px;
                right: 10px;
                min-width: 180px;
            }
        }

        @media (max-width: 600px) {
            .login-box {
                width: 90%;
                padding: 30px 20px;
            }
        }

        /* Special Animations for Real-time Features */
        .data-updating {
            position: relative;
        }

        .data-updating::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(72, 187, 120, 0.1), transparent);
            animation: dataFlow 2s infinite;
        }

        @keyframes dataFlow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body>
    <!-- Real-time Header -->
    <div id="realtimeHeader" class="realtime-header">
        🚀 LIVE REAL-TIME SYSTEM ACTIVE - All changes sync instantly across all devices
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>
    
    <!-- Real-time Status Panel -->
    <div id="realtimeStatus" class="realtime-status">
        <div class="live-dot"></div>
        <div class="connection-info">
            <strong>Real-time Status</strong>
            <span id="connectionDetails">Connecting...</span>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-box">
            <h1>🚀 Employee Portal</h1>
            <div class="realtime-badge">⚡ LIVE REAL-TIME SYSTEM</div>
            <p style="margin-bottom: 20px; color: #666; font-size: 14px;">Complete Management System with Live Updates</p>
            <form id="loginForm">
                <div class="input-group">
                    <label>📧 Email</label>
                    <input type="email" id="email" required placeholder="Enter your email">
                </div>
                <div class="input-group">
                    <label>🔐 Password</label>
                    <input type="password" id="password" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn">
                    <span id="loginBtnText">Login to Real-time System</span>
                    <span id="loginLoader" class="loading" style="display: none;"></span>
                </button>
            </form>
            
            <div style="margin-top: 20px;">
                <p style="margin-bottom: 10px; color: #666;">Live Demo Access:</p>
                <button class="btn btn-demo" onclick="demoLogin('admin')">👨‍💼 Admin (Full Control)</button>
                <button class="btn btn-demo" onclick="demoLogin('employee')">👤 Employee (Live Tasks)</button>
                <p style="font-size: 11px; color: #888; margin-top: 10px;">
                    ⚡ Live updates, Real-time checklists, Instant notifications
                </p>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div>
                    <h1>Welcome, <span id="userName">User</span></h1>
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span id="connectionStatus">LIVE SYSTEM ACTIVE</span>
                    </div>
                </div>
                <div class="user-info">
                    <span class="user-badge" id="userRole">Employee</span>
                    <span id="userEmail">user@example.com</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <!-- Navigation Tabs with Update Badges -->
            <div class="nav-tabs" id="navTabs">
                <!-- Tabs will be dynamically generated -->
            </div>

            <!-- Employee Dashboard Tab -->
            <div id="employeeDashboard" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card" id="todayHoursCard">
                        <div class="stat-number" id="todayHours">0h 0m</div>
                        <div class="stat-label">Today's Hours (Live)</div>
                    </div>
                    <div class="stat-card" id="thisWeekHoursCard">
                        <div class="stat-number" id="thisWeekHours">0h 0m</div>
                        <div class="stat-label">This Week (Live)</div>
                    </div>
                    <div class="stat-card" id="totalTasksCard">
                        <div class="stat-number" id="totalTasks">0</div>
                        <div class="stat-label">Active Tasks (Live)</div>
                    </div>
                    <div class="stat-card" id="taskCompletionCard">
                        <div class="stat-number" id="taskCompletion">0%</div>
                        <div class="stat-label">Completion (Live)</div>
                    </div>
                </div>

                <div class="grid">
                    <!-- Live Attendance Card -->
                    <div class="card" id="attendanceCard">
                        <h2>
                            <div class="card-icon">⏰</div>
                            Live Attendance Tracking
                        </h2>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <span id="attendanceStatus" class="status-badge status-out">Not Checked In</span>
                        </div>
                        
                        <div class="time-display">
                            <div class="time-item" id="checkInTimeItem">
                                <h4>Check In</h4>
                                <span id="checkInTime">--:--</span>
                            </div>
                            <div class="time-item" id="workingTimeItem">
                                <h4>Working (Live)</h4>
                                <span id="workingTime">0h 0m</span>
                            </div>
                            <div class="time-item" id="breakTimeItem">
                                <h4>Break</h4>
                                <span id="breakTime">0h 0m</span>
                            </div>
                            <div class="time-item" id="checkOutTimeItem">
                                <h4>Check Out</h4>
                                <span id="checkOutTime">--:--</span>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button id="checkInBtn" class="btn btn-success" onclick="checkIn()">🚀 Live Check In</button>
                            <button id="checkOutBtn" class="btn btn-danger" onclick="checkOut()" disabled>🏁 Live Check Out</button>
                            <button id="breakBtn" class="btn btn-warning" onclick="toggleBreak()" disabled>☕ Live Break</button>
                        </div>
                    </div>

                    <!-- Live Tasks Card -->
                    <div class="card" id="tasksCard">
                        <h2>
                            <div class="card-icon">📋</div>
                            Live Tasks & Checklists
                        </h2>
                        <div id="myTaskList" class="task-list">
                            <!-- Live tasks with real-time checklists -->
                        </div>
                    </div>

                    <!-- Live Schedule Card -->
                    <div class="card" id="scheduleCard">
                        <h2>
                            <div class="card-icon">📅</div>
                            Live Schedule
                        </h2>
                        <div id="mySchedule">
                            <!-- Live schedule updates -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Dashboard Tab -->
            <div id="adminDashboard" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card" id="totalEmployeesCard">
                        <div class="stat-number" id="totalEmployees">0</div>
                        <div class="stat-label">Total Employees (Live)</div>
                    </div>
                    <div class="stat-card" id="presentTodayCard">
                        <div class="stat-number" id="presentToday">0</div>
                        <div class="stat-label">Present Today (Live)</div>
                    </div>
                    <div class="stat-card" id="absentTodayCard">
                        <div class="stat-number" id="absentToday">0</div>
                        <div class="stat-label">Absent Today (Live)</div>
                    </div>
                    <div class="stat-card" id="onBreakCard">
                        <div class="stat-number" id="onBreak">0</div>
                        <div class="stat-label">On Break (Live)</div>
                    </div>
                </div>

                <div class="grid">
                    <!-- Admin Controls -->
                    <div class="card">
                        <h2>
                            <div class="card-icon">⚡</div>
                            Live Admin Controls
                        </h2>
                        <div style="display: grid; gap: 10px;">
                            <button class="btn btn-info" onclick="openAddEmployeeModal()">➕ Add Employee (Live)</button>
                            <button class="btn btn-info" onclick="openAddTaskModal()">📝 Assign Live Task</button>
                            <button class="btn btn-info" onclick="openCreateRosterModal()">📅 Create Live Schedule</button>
                            <button class="btn btn-info" onclick="openHolidayModal()">🎉 Add Holiday</button>
                            <button class="btn btn-warning" onclick="triggerSystemUpdate()">🔄 Force Sync All</button>
                        </div>
                    </div>

                    <!-- Live Attendance Monitor -->
                    <div class="card" id="liveAttendanceCard">
                        <h2>
                            <div class="card-icon">👥</div>
                            Live Attendance Monitor
                        </h2>
                        <div id="liveAttendance">
                            <!-- Real-time attendance monitoring -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employee Management Tab -->
            <div id="employeeManagement" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                    <h2>👥 Live Employee Management</h2>
                    <button class="btn btn-info" onclick="openAddEmployeeModal()">➕ Add Employee</button>
                </div>
                <div id="employeeList" class="data-updating">
                    <!-- Live employee list -->
                </div>
            </div>

            <!-- Task Management Tab -->
            <div id="taskManagement" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                    <h2>📋 Live Task Management</h2>
                    <button class="btn btn-info" onclick="openAddTaskModal()">➕ Assign Task</button>
                </div>
                <div id="allTasksList" class="data-updating">
                    <!-- Live all tasks -->
                </div>
            </div>

            <!-- Leave Management Tab -->
            <div id="leaveManagement" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                    <h2>🏖️ Live Leave Management</h2>
                    <button class="btn btn-info" onclick="openApplyLeaveModal()">➕ Apply Leave</button>
                </div>
                <div id="leaveRequestsList" class="data-updating">
                    <!-- Live leave requests -->
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Add Employee Modal -->
    <div id="addEmployeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>➕ Add New Employee (Live System)</h3>
                <button class="close" onclick="closeModal('addEmployeeModal')">&times;</button>
            </div>
            <form id="addEmployeeForm">
                <div class="form-row">
                    <div class="input-group">
                        <label>👤 Full Name</label>
                        <input type="text" id="empName" placeholder="John Doe" required>
                    </div>
                    <div class="input-group">
                        <label>📧 Email (Login Email)</label>
                        <input type="email" id="empEmail" placeholder="john@company.com" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>🔐 Password (Login Password)</label>
                        <input type="password" id="empPassword" placeholder="Minimum 6 characters" required minlength="6">
                    </div>
                    <div class="input-group">
                        <label>📞 Phone</label>
                        <input type="text" id="empPhone" placeholder="+91 9876543210">
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>🏢 Department</label>
                        <select id="empDepartment">
                            <option value="IT">IT</option>
                            <option value="HR">HR</option>
                            <option value="Finance">Finance</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Operations">Operations</option>
                            <option value="Sales">Sales</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>👑 Role</label>
                        <select id="empRole">
                            <option value="employee">Employee</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>💰 Salary</label>
                        <input type="number" id="empSalary" placeholder="50000">
                    </div>
                    <div class="input-group">
                        <label>📅 Join Date</label>
                        <input type="date" id="empJoinDate">
                    </div>
                </div>
                <button type="submit" class="btn">🚀 Add Employee to Live System</button>
            </form>
        </div>
    </div>

    <!-- Enhanced Add Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📝 Assign Live Task with Checklist</h3>
                <button class="close" onclick="closeModal('addTaskModal')">&times;</button>
            </div>
            <form id="addTaskForm">
                <div class="input-group">
                    <label>👤 Assign To</label>
                    <select id="taskAssignTo" required>
                        <option value="">Select Employee</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>📋 Task Title</label>
                    <input type="text" id="taskTitle" required placeholder="Complete project documentation">
                </div>
                <div class="input-group">
                    <label>📝 Description</label>
                    <textarea id="taskDescription" rows="3" placeholder="Detailed task description..."></textarea>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>⚡ Priority</label>
                        <select id="taskPriority" required>
                            <option value="low">🟢 Low</option>
                            <option value="medium" selected>🟡 Medium</option>
                            <option value="high">🔴 High</option>
                            <option value="urgent">🚨 Urgent (Live Alert)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>📅 Due Date</label>
                        <input type="date" id="taskDueDate" required>
                    </div>
                </div>
                <div class="input-group">
                    <label>✅ Live Task Checklist (Each line = Live checklist item)</label>
                    <textarea id="taskSubtasks" rows="4" placeholder="Step 1: Research requirements&#10;Step 2: Create outline&#10;Step 3: Write documentation&#10;Step 4: Review and finalize"></textarea>
                    <small style="color: #666;">⚡ Each line becomes a live checklist item that updates in real-time</small>
                </div>
                <button type="submit" class="btn">🚀 Assign Live Task</button>
            </form>
        </div>
    </div>

    <!-- Enhanced Create Schedule Modal -->
    <div id="createRosterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📅 Create Live Employee Schedule</h3>
                <button class="close" onclick="closeModal('createRosterModal')">&times;</button>
            </div>
            <form id="createRosterForm">
                <div class="form-row">
                    <div class="input-group">
                        <label>👤 Employee</label>
                        <select id="rosterEmployee" required>
                            <option value="">Select Employee</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>📅 Date</label>
                        <input type="date" id="rosterDate" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>🕐 Shift Timing</label>
                        <select id="rosterShift" required>
                            <option value="">Select Shift</option>
                            <option value="morning">🌅 Morning (9 AM - 6 PM)</option>
                            <option value="evening">🌆 Evening (2 PM - 11 PM)</option>
                            <option value="night">🌙 Night (11 PM - 8 AM)</option>
                            <option value="half">🕐 Half Day (9 AM - 1 PM)</option>
                            <option value="off">🏠 Day Off / Holiday</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>📍 Work Location</label>
                        <select id="rosterLocation">
                            <option value="office">🏢 Office</option>
                            <option value="remote">🏠 Remote Work</option>
                            <option value="hybrid">🔄 Hybrid</option>
                            <option value="field">🚗 Field Work</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label>📝 Special Instructions</label>
                    <textarea id="rosterNotes" rows="2" placeholder="Any special instructions for this day..."></textarea>
                </div>
                <button type="submit" class="btn">🚀 Create Live Schedule</button>
            </form>
        </div>
    </div>

    <!-- Enhanced Apply Leave Modal -->
    <div id="applyLeaveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🏖️ Apply for Live Leave</h3>
                <button class="close" onclick="closeModal('applyLeaveModal')">&times;</button>
            </div>
            <form id="applyLeaveForm">
                <div class="form-row">
                    <div class="input-group">
                        <label>📅 From Date</label>
                        <input type="date" id="leaveFromDate" required>
                    </div>
                    <div class="input-group">
                        <label>📅 To Date</label>
                        <input type="date" id="leaveToDate" required>
                    </div>
                </div>
                <div class="input-group">
                    <label>🏷️ Leave Type</label>
                    <select id="leaveType" required>
                        <option value="">Select Leave Type</option>
                        <option value="casual">Casual Leave</option>
                        <option value="sick">Sick Leave</option>
                        <option value="earned">Earned Leave</option>
                        <option value="emergency">Emergency Leave</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>📝 Reason</label>
                    <textarea id="leaveReason" rows="3" required placeholder="Reason for leave..."></textarea>
                </div>
                <button type="submit" class="btn">🚀 Apply Live Leave Request</button>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // 🚀 REAL-TIME EMPLOYEE MANAGEMENT PORTAL
        console.log('🚀 LOADING REAL-TIME SYSTEM...');

        // Supabase Configuration
        const SUPABASE_URL = 'https://sizbhnyyyvbkuarulcmz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNpemJobnl5eXZia3VhcnVsY216Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4MjcxMzQsImV4cCI6MjA3MDQwMzEzNH0.T67uwBYJp6AbaDB1CwbXh18GjvW9KwPBuyoOhniMaF0';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // 🔥 REAL-TIME GLOBAL STATE
        let currentUser = null;
        let attendanceData = {
            isCheckedIn: false,
            isOnBreak: false,
            checkInTime: null,
            breakStart: null,
            totalBreakTime: 0
        };
        let realtimeSubscriptions = [];
        let realtimeChannelCount = 0;
        let updateCounters = {
            employees: 0,
            tasks: 0,
            attendance: 0,
            roster: 0,
            leave_requests: 0
        };

        // 🚀 INITIALIZE REAL-TIME SYSTEM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 REAL-TIME EMPLOYEE PORTAL STARTING...');
            
            // Show real-time header
            document.getElementById('realtimeHeader').style.display = 'block';
            
            checkAuth();
            setupEventListeners();
            
            // Start real-time timers
            setInterval(updateWorkingTime, 1000);           // Every second
            setInterval(updateRealtimeStatus, 3000);       // Every 3 seconds
            setInterval(saveAttendanceData, 10000);        // Every 10 seconds
            setInterval(forceLiveUpdate, 30000);           // Every 30 seconds
            
            console.log('✅ REAL-TIME SYSTEM ACTIVE!');
        });

        function setupEventListeners() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('addEmployeeForm').addEventListener('submit', handleAddEmployee);
            document.getElementById('addTaskForm').addEventListener('submit', handleAddTask);
            document.getElementById('createRosterForm').addEventListener('submit', handleCreateRoster);
            document.getElementById('applyLeaveForm').addEventListener('submit', handleApplyLeave);

            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('empJoinDate').value = today;
            document.getElementById('taskDueDate').value = today;
            document.getElementById('rosterDate').value = today;
            document.getElementById('leaveFromDate').value = today;
            document.getElementById('leaveToDate').value = today;
        }

        function checkAuth() {
            const saved = localStorage.getItem('currentUser');
            if (saved) {
                try {
                    currentUser = JSON.parse(saved);
                    console.log('🔐 User authenticated:', currentUser.name);
                    showDashboard();
                    setupNavigation();
                    loadUserData();
                    
                    // Delay to ensure DOM is ready
                    setTimeout(() => {
                        initializeRealtimeSystem();
                        loadAllData();
                    }, 500);
                    
                } catch (error) {
                    localStorage.removeItem('currentUser');
                    showLogin();
                }
            } else {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboard').classList.remove('show');
        }

        function showDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').classList.add('show');
        }

        // 🚀 REAL-TIME NOTIFICATION SYSTEM
        function showNotification(message, type = 'info', duration = 4000) {
            const notification = document.getElementById('notification');
            notification.textContent = `🚀 ${message}`;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            // Add live sound effect
            if (type === 'success') {
                console.log('🎉 SUCCESS:', message);
            } else if (type === 'error') {
                console.log('❌ ERROR:', message);
            } else {
                console.log('ℹ️ INFO:', message);
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }

        // 🔐 AUTHENTICATION WITH REAL-TIME
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            showLoading('loginBtnText', 'loginLoader');
            
            try {
                // Real-time login check
                const { data: employee, error } = await supabase
                    .from('employees')
                    .select('*')
                    .eq('email', email)
                    .eq('password', password)
                    .single();
                
                if (error || !employee) {
                    throw new Error('Invalid email or password');
                }
                
                currentUser = {
                    id: employee.id,
                    name: employee.name,
                    email: employee.email,
                    role: employee.role,
                    department: employee.department,
                    phone: employee.phone,
                    salary: employee.salary,
                    join_date: employee.join_date
                };
                
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showNotification(`Welcome ${currentUser.name}! Real-time system connected 🚀`, 'success');
                showDashboard();
                setupNavigation();
                loadUserData();
                
                // Initialize real-time system
                setTimeout(() => {
                    initializeRealtimeSystem();
                    loadAllData();
                }, 500);
                
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Login failed. Check your credentials. ❌', 'error');
            } finally {
                hideLoading('loginBtnText', 'loginLoader');
            }
        }

        function demoLogin(type) {
            const demoUsers = {
                admin: {
                    id: 'demo_admin',
                    name: 'Admin Demo',
                    email: 'admin@demo.com',
                    role: 'admin',
                    department: 'Management',
                    phone: '+91 9876543210',
                    salary: 100000,
                    join_date: '2023-01-01'
                },
                employee: {
                    id: 'demo_employee',
                    name: 'John Doe',
                    email: 'john@demo.com',
                    role: 'employee',
                    department: 'IT',
                    phone: '+91 9876543211',
                    salary: 50000,
                    join_date: '2023-06-01'
                }
            };
            
            currentUser = demoUsers[type];
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showNotification(`Demo login: ${currentUser.name} - Real-time active! 🚀`, 'success');
            showDashboard();
            setupNavigation();
            loadUserData();
            
            setTimeout(() => {
                initializeRealtimeSystem();
                loadAllData();
            }, 500);
        }

        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            attendanceData = {
                isCheckedIn: false,
                isOnBreak: false,
                checkInTime: null,
                breakStart: null,
                totalBreakTime: 0
            };
            cleanupRealtimeSubscriptions();
            showNotification('Logged out! Real-time system disconnected 👋', 'info');
            showLogin();
        }

        // 🚀 COMPLETE REAL-TIME SYSTEM
        function initializeRealtimeSystem() {
            console.log('🔥 INITIALIZING COMPLETE REAL-TIME SYSTEM...');
            cleanupRealtimeSubscriptions();
            
            const tables = ['employees', 'tasks', 'attendance', 'roster', 'leave_requests'];
            
            tables.forEach((table, index) => {
                setupRealtimeChannel(table, index);
            });
            
            // Setup user presence
            setupUserPresence();
            
            // Update status immediately
            updateRealtimeStatus();
            
            console.log('✅ REAL-TIME SYSTEM INITIALIZED!');
        }

        function setupRealtimeChannel(table, index) {
            try {
                const channelName = `live-${table}-${currentUser.id}-${Date.now()}-${index}`;
                
                const subscription = supabase
                    .channel(channelName)
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: table
                    }, (payload) => {
                        console.log(`🔥 REAL-TIME ${table.toUpperCase()}:`, payload);
                        handleRealtimeUpdate(table, payload);
                    })
                    .subscribe((status) => {
                        console.log(`📡 Channel ${table} status:`, status);
                        if (status === 'SUBSCRIBED') {
                            realtimeChannelCount++;
                            updateCounters[table]++;
                            showNotification(`${table} real-time connected! Channel ${realtimeChannelCount}/5`, 'success', 2000);
                            updateRealtimeStatus();
                            addUpdateBadge(table);
                        } else if (status === 'CHANNEL_ERROR') {
                            console.error(`❌ Channel ${table} error:`, status);
                            showNotification(`${table} connection failed! Retrying...`, 'error', 3000);
                        }
                    });
                
                realtimeSubscriptions.push(subscription);
                
            } catch (error) {
                console.error(`Failed to setup ${table} channel:`, error);
                showNotification(`Failed to connect ${table} real-time!`, 'error');
            }
        }

        function setupUserPresence() {
            try {
                const presenceChannel = supabase.channel('user-presence', {
                    config: {
                        presence: {
                            key: currentUser.id,
                        },
                    },
                });

                presenceChannel.on('presence', { event: 'sync' }, () => {
                    const state = presenceChannel.presenceState();
                    const users = Object.keys(state).length;
                    console.log('👥 Live users:', users);
                    updateOnlineUsersCount(users);
                });

                presenceChannel.subscribe(async (status) => {
                    if (status === 'SUBSCRIBED') {
                        await presenceChannel.track({
                            user_id: currentUser.id,
                            user_name: currentUser.name,
                            role: currentUser.role,
                            online_at: new Date().toISOString(),
                        });
                        console.log('✅ User presence active');
                    }
                });

                realtimeSubscriptions.push(presenceChannel);
                
            } catch (error) {
                console.error('Failed to setup user presence:', error);
            }
        }

        function handleRealtimeUpdate(table, payload) {
            const actions = {
                INSERT: '➕ Added',
                UPDATE: '🔄 Updated', 
                DELETE: '🗑️ Removed'
            };
            
            const action = actions[payload.eventType] || '🔄 Changed';
            
            // Show live notification
            showNotification(`${table}: ${action} (Live Update)`, 'info', 3000);
            
            // Add visual effects
            triggerLiveUpdateAnimation(table);
            
            // Update specific data
            refreshDataByTable(table);
            
            // Update counters
            updateCounters[table]++;
            updateTabBadges();
            
            console.log(`🔥 LIVE UPDATE: ${table} ${action}`);
        }

        function triggerLiveUpdateAnimation(table) {
            // Add glow effect to relevant cards
            const tableCardMap = {
                employees: ['employeeList', 'totalEmployeesCard'],
                tasks: ['myTaskList', 'allTasksList', 'tasksCard', 'totalTasksCard'],
                attendance: ['attendanceCard', 'liveAttendanceCard'],
                roster: ['scheduleCard'],
                leave_requests: ['leaveRequestsList']
            };
            
            const cardIds = tableCardMap[table] || [];
            cardIds.forEach(cardId => {
                const card = document.getElementById(cardId);
                if (card) {
                    card.classList.add('updated');
                    setTimeout(() => {
                        card.classList.remove('updated');
                    }, 2000);
                }
            });
        }

        function refreshDataByTable(table) {
            switch(table) {
                case 'employees':
                    loadEmployeeManagement();
                    updateEmployeeDropdowns();
                    loadAdminStats();
                    break;
                case 'tasks':
                    loadMyTasks();
                    loadTaskManagement();
                    break;
                case 'attendance':
                    loadLiveAttendance();
                    loadAdminStats();
                    break;
                case 'roster':
                    loadMySchedule();
                    break;
                case 'leave_requests':
                    loadLeaveManagement();
                    break;
            }
        }

        function updateRealtimeStatus() {
            const statusEl = document.getElementById('realtimeStatus');
            const connectionEl = document.getElementById('connectionStatus');
            const detailsEl = document.getElementById('connectionDetails');
            
            if (!statusEl || !connectionEl || !detailsEl) return;
            
            const totalChannels = 6; // 5 tables + 1 presence
            
            if (realtimeChannelCount >= totalChannels - 1) {
                statusEl.className = 'realtime-status active';
                connectionEl.textContent = 'LIVE SYSTEM ACTIVE';
                detailsEl.textContent = `${realtimeChannelCount}/${totalChannels} channels connected`;
                console.log('✅ FULL REAL-TIME ACTIVE!');
            } else if (realtimeChannelCount > 0) {
                statusEl.className = 'realtime-status';
                connectionEl.textContent = 'CONNECTING...';
                detailsEl.textContent = `${realtimeChannelCount}/${totalChannels} channels connected`;
                console.log(`⏳ Connecting: ${realtimeChannelCount}/${totalChannels}`);
            } else {
                statusEl.className = 'realtime-status';
                connectionEl.textContent = 'OFFLINE MODE';
                detailsEl.textContent = 'No real-time connection';
                console.log('❌ No real-time connection');
            }
        }

        function cleanupRealtimeSubscriptions() {
            realtimeSubscriptions.forEach(sub => {
                try {
                    sub.unsubscribe();
                } catch (error) {
                    console.error('Error unsubscribing:', error);
                }
            });
            realtimeSubscriptions = [];
            realtimeChannelCount = 0;
            updateRealtimeStatus();
        }

        // 🎯 TAB NAVIGATION WITH LIVE BADGES
        function setupNavigation() {
            const navTabs = document.getElementById('navTabs');
            const isAdmin = currentUser && currentUser.role === 'admin';
            
            const tabs = [
                { id: 'employeeDashboard', label: '🏠 Dashboard', show: true },
                { id: 'employeeManagement', label: '👥 Employees', show: isAdmin },
                { id: 'taskManagement', label: '📋 Tasks', show: isAdmin },
                { id: 'leaveManagement', label: '🏖️ Leave', show: true }
            ];

            const visibleTabs = tabs.filter(tab => tab.show);
            
            navTabs.innerHTML = visibleTabs
                .map((tab, index) => 
                    `<button class="nav-tab ${index === 0 ? 'active' : ''}" onclick="switchTab('${tab.id}')" id="tab-${tab.id}">
                        ${tab.label}
                        <span class="update-badge" id="badge-${tab.id}" style="display: none;">!</span>
                    </button>`
                ).join('');

            setTimeout(() => {
                switchTab('employeeDashboard');
            }, 100);
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabId).classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');
            
            // Hide badge when tab is viewed
            const badge = document.getElementById(`badge-${tabId}`);
            if (badge) {
                badge.style.display = 'none';
            }
            
            loadTabData(tabId);
        }

        function addUpdateBadge(table) {
            const tableBadgeMap = {
                employees: 'employeeManagement',
                tasks: 'taskManagement',
                leave_requests: 'leaveManagement'
            };
            
            const tabId = tableBadgeMap[table];
            if (tabId) {
                const badge = document.getElementById(`badge-${tabId}`);
                if (badge && !document.getElementById(`tab-${tabId}`).classList.contains('active')) {
                    badge.style.display = 'flex';
                }
            }
        }

        function updateTabBadges() {
            // Update tab badges with update counts
            Object.keys(updateCounters).forEach(table => {
                const count = updateCounters[table];
                if (count > 0) {
                    addUpdateBadge(table);
                }
            });
        }

        function loadTabData(tabId) {
            switch(tabId) {
                case 'employeeDashboard':
                    loadMyTasks();
                    loadMySchedule();
                    loadAttendance();
                    break;
                case 'employeeManagement':
                    loadEmployeeManagement();
                    break;
                case 'taskManagement':
                    loadTaskManagement();
                    break;
                case 'leaveManagement':
                    loadLeaveManagement();
                    break;
            }
        }

        function loadUserData() {
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userRole').textContent = currentUser.role.toUpperCase();
        }

        function loadAllData() {
            console.log('📊 Loading all live data...');
            
            loadAttendance();
            loadMyTasks();
            loadMySchedule();
            
            if (currentUser && currentUser.role === 'admin') {
                loadAdminStats();
                loadLiveAttendance();
                loadEmployeeManagement();
            }
            
            updateEmployeeDropdowns();
            
            console.log('✅ All data loaded!');
        }

        // 🎯 EMPLOYEE MANAGEMENT WITH LIVE UPDATES
        async function handleAddEmployee(e) {
            e.preventDefault();
            
            const employeeData = {
                name: document.getElementById('empName').value,
                email: document.getElementById('empEmail').value,
                password: document.getElementById('empPassword').value,
                phone: document.getElementById('empPhone').value || null,
                department: document.getElementById('empDepartment').value,
                role: document.getElementById('empRole').value,
                salary: parseFloat(document.getElementById('empSalary').value) || null,
                join_date: document.getElementById('empJoinDate').value || null
            };
            
            if (employeeData.password.length < 6) {
                showNotification('Password must be at least 6 characters! ⚠️', 'error');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('employees')
                    .insert([employeeData])
                    .select();

                if (error) throw error;
                
                showNotification(`Employee ${employeeData.name} added to live system! Login: ${employeeData.email} 🎉`, 'success');
                closeModal('addEmployeeModal');
                e.target.reset();
                
                // Real-time will handle the update automatically
                
            } catch (error) {
                console.error('Add employee error:', error);
                if (error.code === '23505') {
                    showNotification('Email already exists! Please use different email. ⚠️', 'error');
                } else {
                    showNotification(`Failed to add employee: ${error.message} ❌`, 'error');
                }
            }
        }

        // 🎯 TASK MANAGEMENT WITH LIVE CHECKLISTS
        async function handleAddTask(e) {
            e.preventDefault();
            
            const subtasksText = document.getElementById('taskSubtasks').value;
            const subtasks = subtasksText
                .split('\n')
                .filter(task => task.trim())
                .map(task => ({ text: task.trim(), completed: false }));
            
            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                due_date: document.getElementById('taskDueDate').value,
                assigned_to: document.getElementById('taskAssignTo').value,
                created_by: currentUser.id,
                status: 'pending',
                subtasks: JSON.stringify(subtasks),
                progress: 0
            };
            
            try {
                const { error } = await supabase
                    .from('tasks')
                    .insert([taskData]);

                if (error) throw error;
                
                showNotification(`Live task assigned with ${subtasks.length} checklist items! 📝🚀`, 'success');
                closeModal('addTaskModal');
                e.target.reset();
                
                // Real-time will handle the update automatically
                
            } catch (error) {
                console.error('Add task error:', error);
                showNotification('Failed to assign task ❌', 'error');
            }
        }

        async function updateSubtask(taskId, subtaskIndex, completed) {
            try {
                const { data: task } = await supabase
                    .from('tasks')
                    .select('subtasks')
                    .eq('id', taskId)
                    .single();
                
                if (task && task.subtasks) {
                    const subtasks = JSON.parse(task.subtasks);
                    subtasks[subtaskIndex].completed = completed;
                    
                    const completedCount = subtasks.filter(st => st.completed).length;
                    const progress = Math.round((completedCount / subtasks.length) * 100);
                    
                    await supabase
                        .from('tasks')
                        .update({ 
                            subtasks: JSON.stringify(subtasks),
                            progress: progress,
                            status: progress === 100 ? 'completed' : 'in_progress'
                        })
                        .eq('id', taskId);
                    
                    showNotification(`Live checklist updated! ${completed ? '✅' : '⬜'} (${progress}%)`, 'success');
                    
                    if (progress === 100) {
                        showNotification('🎉 Task completed! All checklist items done! 🚀', 'success');
                    }
                    
                    // Add visual effect
                    const checklistItem = event.target.closest('.checklist-item');
                    if (checklistItem) {
                        checklistItem.classList.toggle('completed', completed);
                    }
                }
            } catch (error) {
                console.error('Error updating subtask:', error);
                showNotification('Failed to update checklist item ❌', 'error');
            }
        }

        // 🎯 SCHEDULE MANAGEMENT
        async function handleCreateRoster(e) {
            e.preventDefault();
            
            const rosterData = {
                employee_id: document.getElementById('rosterEmployee').value,
                date: document.getElementById('rosterDate').value,
                shift: document.getElementById('rosterShift').value,
                location: document.getElementById('rosterLocation').value,
                notes: document.getElementById('rosterNotes').value,
                created_by: currentUser.id
            };
            
            try {
                const { error } = await supabase
                    .from('roster')
                    .upsert([rosterData]);

                if (error) throw error;
                
                showNotification('Live employee schedule created! 📅🚀', 'success');
                closeModal('createRosterModal');
                e.target.reset();
                
            } catch (error) {
                console.error('Create roster error:', error);
                showNotification('Failed to create schedule ❌', 'error');
            }
        }

        // 🎯 LEAVE MANAGEMENT
        async function handleApplyLeave(e) {
            e.preventDefault();
            
            const fromDate = new Date(document.getElementById('leaveFromDate').value);
            const toDate = new Date(document.getElementById('leaveToDate').value);
            const days = Math.ceil((toDate - fromDate) / (1000 * 60 * 60 * 24)) + 1;
            
            const leaveData = {
                employee_id: currentUser.id,
                leave_type: document.getElementById('leaveType').value,
                from_date: document.getElementById('leaveFromDate').value,
                to_date: document.getElementById('leaveToDate').value,
                reason: document.getElementById('leaveReason').value,
                status: 'pending',
                days: days
            };
            
            try {
                const { error } = await supabase
                    .from('leave_requests')
                    .insert([leaveData]);

                if (error) throw error;
                
                showNotification(`Live leave request submitted for ${days} day(s)! 🏖️🚀`, 'success');
                closeModal('applyLeaveModal');
                e.target.reset();
                
            } catch (error) {
                console.error('Apply leave error:', error);
                showNotification('Failed to submit leave application ❌', 'error');
            }
        }

        // 🎯 DATA LOADING FUNCTIONS WITH LIVE UPDATES
        async function loadMyTasks() {
            const container = document.getElementById('myTaskList');
            
            if (!container) return;
            
            try {
                console.log('📋 Loading live tasks...');
                
                const { data: tasks, error } = await supabase
                    .from('tasks')
                    .select('*')
                    .eq('assigned_to', currentUser.id)
                    .order('priority', { ascending: false })
                    .order('due_date', { ascending: true });
                
                if (error) {
                    container.innerHTML = '<p style="color: #e53e3e;">Error loading live tasks</p>';
                    return;
                }
                
                if (tasks && tasks.length > 0) {
                    container.innerHTML = tasks.map(task => {
                        const subtasks = task.subtasks ? JSON.parse(task.subtasks) : [];
                        const completedSubtasks = subtasks.filter(st => st.completed).length;
                        const progress = subtasks.length > 0 ? Math.round((completedSubtasks / subtasks.length) * 100) : 0;
                        
                        return `
                            <div class="task-item" id="task-${task.id}">
                                <div class="task-header">
                                    <div class="task-title">🚀 ${task.title}</div>
                                    <span class="priority-${task.priority}">${getPriorityIcon(task.priority)} ${task.priority.toUpperCase()}</span>
                                </div>
                                <p>${task.description || 'No description'}</p>
                                
                                ${subtasks.length > 0 ? `
                                    <div class="task-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${progress}%"></div>
                                        </div>
                                        <div class="progress-text">Live Progress: ${completedSubtasks}/${subtasks.length} items (${progress}%)</div>
                                    </div>
                                    
                                    <div class="task-checklist">
                                        <strong>📝 Live Checklist:</strong>
                                        ${subtasks.map((subtask, index) => `
                                            <div class="checklist-item ${subtask.completed ? 'completed' : ''}">
                                                <input type="checkbox" ${subtask.completed ? 'checked' : ''} 
                                                       onchange="updateSubtask('${task.id}', ${index}, this.checked)">
                                                <span style="${subtask.completed ? 'text-decoration: line-through; color: #666;' : ''}">${subtask.text}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                <div class="task-meta">
                                    <span>Due: ${new Date(task.due_date).toLocaleDateString()}</span>
                                    <span class="status-badge ${task.status === 'completed' ? 'status-working' : task.status === 'in_progress' ? 'status-break' : 'status-out'}">${task.status}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    // Update live stats
                    updateStatCard('totalTasks', tasks.length);
                    const completedTasks = tasks.filter(t => t.status === 'completed').length;
                    const completion = tasks.length > 0 ? Math.round((completedTasks / tasks.length) * 100) : 0;
                    updateStatCard('taskCompletion', `${completion}%`);
                    
                } else {
                    container.innerHTML = '<p style="text-align: center; color: #666;">No live tasks assigned yet 📋</p>';
                    updateStatCard('totalTasks', '0');
                    updateStatCard('taskCompletion', '0%');
                }
                
                console.log('✅ Live tasks loaded:', tasks?.length || 0);
                
            } catch (error) {
                console.error('Error loading tasks:', error);
                container.innerHTML = '<p style="color: #e53e3e;">Error loading live tasks</p>';
            }
        }

        async function loadTaskManagement() {
            const container = document.getElementById('allTasksList');
            
            if (!container) return;
            
            try {
                const { data: tasks } = await supabase
                    .from('tasks')
                    .select(`
                        *,
                        assignee:employees!tasks_assigned_to_fkey(name),
                        creator:employees!tasks_created_by_fkey(name)
                    `)
                    .order('created_at', { ascending: false });

                if (tasks && tasks.length > 0) {
                    container.innerHTML = `
                        <div style="margin-bottom: 15px; padding: 10px; background: #e6fffa; border-radius: 8px; text-align: center;">
                            <strong>🚀 Live Task Management: ${tasks.length} total tasks</strong>
                        </div>
                    ` + tasks.map(task => {
                        const subtasks = task.subtasks ? JSON.parse(task.subtasks) : [];
                        const completedSubtasks = subtasks.filter(st => st.completed).length;
                        const progress = subtasks.length > 0 ? Math.round((completedSubtasks / subtasks.length) * 100) : 0;
                        
                        return `
                            <div class="task-item">
                                <div class="task-header">
                                    <div>
                                        <div class="task-title">🚀 ${task.title}</div>
                                        <p>Assigned to: ${task.assignee?.name || 'Unknown'} | Created by: ${task.creator?.name || 'Unknown'}</p>
                                    </div>
                                    <span class="priority-${task.priority}">${getPriorityIcon(task.priority)} ${task.priority.toUpperCase()}</span>
                                </div>
                                <p>${task.description || 'No description'}</p>
                                
                                ${subtasks.length > 0 ? `
                                    <div class="task-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${progress}%"></div>
                                        </div>
                                        <div class="progress-text">Live Progress: ${completedSubtasks}/${subtasks.length} items (${progress}%)</div>
                                    </div>
                                    
                                    <div class="task-checklist">
                                        <strong>📝 Live Checklist:</strong>
                                        ${subtasks.map((subtask, index) => `
                                            <div class="checklist-item ${subtask.completed ? 'completed' : ''}">
                                                <input type="checkbox" ${subtask.completed ? 'checked' : ''} disabled>
                                                <span style="${subtask.completed ? 'text-decoration: line-through; color: #666;' : ''}">${subtask.text}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                <div class="task-meta">
                                    <span>Due: ${new Date(task.due_date).toLocaleDateString()}</span>
                                    <span class="status-badge ${task.status === 'completed' ? 'status-working' : task.status === 'in_progress' ? 'status-break' : 'status-out'}">${task.status}</span>
                                    <button class="btn-small btn-danger" onclick="deleteTask('${task.id}')">🗑️ Delete</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    container.innerHTML = '<p style="text-align: center; color: #666;">No live tasks assigned yet 📋</p>';
                }
                
            } catch (error) {
                console.error('Error loading all tasks:', error);
                container.innerHTML = '<p style="text-align: center; color: #e53e3e;">Error loading live tasks</p>';
            }
        }

        async function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this live task?')) return;
            
            try {
                const { error } = await supabase
                    .from('tasks')
                    .delete()
                    .eq('id', taskId);

                if (error) throw error;
                
                showNotification('Live task deleted! 🗑️🚀', 'success');
                
            } catch (error) {
                console.error('Delete task error:', error);
                showNotification('Failed to delete task ❌', 'error');
            }
        }

        async function loadEmployeeManagement() {
            const container = document.getElementById('employeeList');
            
            if (!container) return;
            
            try {
                const { data: employees, error } = await supabase
                    .from('employees')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (employees && employees.length > 0) {
                    container.innerHTML = `
                        <div style="margin-bottom: 15px; padding: 10px; background: #e6fffa; border-radius: 8px; text-align: center;">
                            <strong>🚀 Live Employee Database: ${employees.length} employees</strong>
                            <span style="color: #1890ff; font-size: 12px; margin-left: 10px;">Real-time updates active</span>
                        </div>
                    ` + employees.map(emp => `
                        <div class="employee-card" id="employee-${emp.id}">
                            <div class="employee-info">
                                <h4>🚀 ${emp.name}</h4>
                                <p>📧 ${emp.email} | 🏢 ${emp.department} | 👤 ${emp.role}</p>
                                <p>📞 ${emp.phone || 'N/A'} | 💰 ₹${emp.salary || 'N/A'} | 📅 ${emp.join_date || 'N/A'}</p>
                                <p style="font-size: 11px; color: #666;">🔐 Live Login: ${emp.email} / ••••••</p>
                            </div>
                            <div class="employee-actions">
                                <button class="btn-small btn-warning" onclick="resetPassword('${emp.id}', '${emp.name}')">🔐 Reset</button>
                                <button class="btn-small btn-info" onclick="createScheduleFor('${emp.id}')">📅 Schedule</button>
                                <button class="btn-small btn-danger" onclick="deleteEmployee('${emp.id}')">🗑️ Delete</button>
                            </div>
                        </div>
                    `).join('');
                    
                    updateStatCard('totalEmployees', employees.length);
                } else {
                    container.innerHTML = '<p style="text-align: center; color: #666;">No employees in live system</p>';
                }
                
            } catch (error) {
                console.error('Error loading employees:', error);
                container.innerHTML = '<p style="color: #e53e3e;">Error loading live employees</p>';
            }
        }

        async function resetPassword(employeeId, employeeName) {
            const newPassword = prompt(`Enter new password for ${employeeName} (minimum 6 characters):`);
            if (newPassword && newPassword.length >= 6) {
                try {
                    const { error } = await supabase
                        .from('employees')
                        .update({ password: newPassword })
                        .eq('id', employeeId);
                    
                    if (error) throw error;
                    
                    showNotification(`Live password reset for ${employeeName}! New: ${newPassword} 🔐🚀`, 'success');
                } catch (error) {
                    console.error('Error resetting password:', error);
                    showNotification('Failed to reset password ❌', 'error');
                }
            } else if (newPassword !== null) {
                showNotification('Password must be at least 6 characters! ⚠️', 'error');
            }
        }

        async function createScheduleFor(employeeId) {
            document.getElementById('rosterEmployee').value = employeeId;
            openCreateRosterModal();
        }

        async function deleteEmployee(employeeId) {
            if (!confirm('Are you sure you want to delete this employee from live system?')) return;
            
            try {
                const { error } = await supabase
                    .from('employees')
                    .delete()
                    .eq('id', employeeId);

                if (error) throw error;
                
                showNotification('Employee deleted from live system! 🗑️🚀', 'success');
                
            } catch (error) {
                console.error('Delete employee error:', error);
                showNotification('Failed to delete employee ❌', 'error');
            }
        }

        async function updateEmployeeDropdowns() {
            try {
                const { data: employees } = await supabase
                    .from('employees')
                    .select('id, name')
                    .order('name');

                const options = employees?.map(emp => `<option value="${emp.id}">${emp.name}</option>`).join('') || '';
                
                const selects = ['taskAssignTo', 'rosterEmployee'];
                selects.forEach(id => {
                    const select = document.getElementById(id);
                    if (select) {
                        select.innerHTML = '<option value="">Select Employee</option>' + options;
                    }
                });
            } catch (error) {
                console.error('Error updating dropdowns:', error);
            }
        }

        async function loadMySchedule() {
            const container = document.getElementById('mySchedule');
            
            if (!container) return;
            
            try {
                const today = new Date().toISOString().split('T')[0];
                const { data: todayRoster } = await supabase
                    .from('roster')
                    .select('*')
                    .eq('employee_id', currentUser.id)
                    .eq('date', today)
                    .single();

                if (todayRoster) {
                    container.innerHTML = `
                        <div style="margin-bottom: 15px;">
                            <h4>📅 Live Today's Schedule</h4>
                            <div style="padding: 15px; background: #e6fffa; border-radius: 8px; margin-top: 10px; border-left: 4px solid #48bb78;">
                                <p><strong>🚀 ${getShiftTime(todayRoster.shift)}</strong></p>
                                <p>${getShiftIcon(todayRoster.shift)} ${todayRoster.shift.charAt(0).toUpperCase() + todayRoster.shift.slice(1)} Shift</p>
                                <p>${getLocationIcon(todayRoster.location)} ${todayRoster.location.charAt(0).toUpperCase() + todayRoster.location.slice(1)}</p>
                                <p>📝 ${todayRoster.notes || 'Regular working day'}</p>
                                <p style="font-size: 12px; color: #666;">⚡ Live schedule - updates in real-time</p>
                            </div>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div style="margin-bottom: 15px;">
                            <h4>📅 Live Today's Schedule</h4>
                            <div style="padding: 15px; background: #f7fafc; border-radius: 8px; margin-top: 10px;">
                                <p style="color: #666;">No specific schedule assigned for today</p>
                                <p style="font-size: 12px;">Default: 9 AM - 6 PM Office</p>
                                <p style="font-size: 12px; color: #48bb78;">⚡ Live schedule system active</p>
                            </div>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading schedule:', error);
                container.innerHTML = '<p style="color: #e53e3e;">Error loading live schedule</p>';
            }
        }

        async function loadLeaveManagement() {
            const container = document.getElementById('leaveRequestsList');
            
            if (!container) return;
            
            try {
                const { data: leaveRequests } = await supabase
                    .from('leave_requests')
                    .select('*')
                    .eq('employee_id', currentUser.id)
                    .order('created_at', { ascending: false });

                container.innerHTML = `
                    <div class="card">
                        <h3>📊 Live Leave Balance</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div style="text-align: center; padding: 15px; background: #e6fffa; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #48bb78;">12</div>
                                <div style="font-size: 12px; color: #666;">Casual Leave</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #e6fffa; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #4299e1;">7</div>
                                <div style="font-size: 12px; color: #666;">Sick Leave</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #e6fffa; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #ed8936;">21</div>
                                <div style="font-size: 12px; color: #666;">Earned Leave</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>📝 Live Leave Requests</h3>
                        ${!leaveRequests || leaveRequests.length === 0 ? 
                            '<p style="text-align: center; color: #666;">No live leave requests yet 🏖️</p>' : 
                            leaveRequests.map(request => `
                                <div class="task-item">
                                    <div class="task-header">
                                        <div>
                                            <div class="task-title">🚀 ${request.leave_type.charAt(0).toUpperCase() + request.leave_type.slice(1)} Leave</div>
                                            <p>${new Date(request.from_date).toLocaleDateString()} - ${new Date(request.to_date).toLocaleDateString()}</p>
                                        </div>
                                        <span class="status-badge ${getLeaveStatusClass(request.status)}">${getLeaveStatusIcon(request.status)} ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}</span>
                                    </div>
                                    <p>${request.reason}</p>
                                    <div class="task-meta">
                                        <span>Applied: ${new Date(request.created_at).toLocaleDateString()}</span>
                                        <span>${request.days || calculateLeaveDays(request.from_date, request.to_date)} days</span>
                                        ${currentUser.role === 'admin' && request.status === 'pending' ? `
                                            <button class="btn-small btn-success" onclick="approveLeave('${request.id}')">✅ Approve</button>
                                            <button class="btn-small btn-danger" onclick="rejectLeave('${request.id}')">❌ Reject</button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading leave management:', error);
                container.innerHTML = '<p style="color: #e53e3e;">Error loading live leave data</p>';
            }
        }

        async function approveLeave(leaveId) {
            try {
                const { error } = await supabase
                    .from('leave_requests')
                    .update({ status: 'approved' })
                    .eq('id', leaveId);

                if (error) throw error;
                showNotification('Live leave approved! ✅🚀', 'success');
                
            } catch (error) {
                console.error('Approve leave error:', error);
                showNotification('Failed to approve leave ❌', 'error');
            }
        }

        async function rejectLeave(leaveId) {
            try {
                const { error } = await supabase
                    .from('leave_requests')
                    .update({ status: 'rejected' })
                    .eq('id', leaveId);

                if (error) throw error;
                showNotification('Live leave rejected! ❌🚀', 'error');
                
            } catch (error) {
                console.error('Reject leave error:', error);
                showNotification('Failed to reject leave ❌', 'error');
            }
        }

        async function loadAdminStats() {
            if (currentUser.role !== 'admin') return;
            
            try {
                const { data: employees } = await supabase
                    .from('employees')
                    .select('id');
                
                const today = new Date().toISOString().split('T')[0];
                const { data: attendance } = await supabase
                    .from('attendance')
                    .select('status')
                    .eq('date', today);
                
                const totalEmployees = employees?.length || 0;
                const presentToday = attendance?.filter(a => a.status === 'present').length || 0;
                const absentToday = totalEmployees - presentToday;
                
                updateStatCard('totalEmployees', totalEmployees);
                updateStatCard('presentToday', presentToday);
                updateStatCard('absentToday', absentToday);
                updateStatCard('onBreak', '0');
                
            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }

        async function loadLiveAttendance() {
            const container = document.getElementById('liveAttendance');
            
            if (!container) return;
            
            try {
                const today = new Date().toISOString().split('T')[0];
                const { data: liveData } = await supabase
                    .from('employees')
                    .select(`
                        name, 
                        department,
                        attendance!left(status, check_in)
                    `)
                    .eq('attendance.date', today);

                if (liveData && liveData.length > 0) {
                    container.innerHTML = `
                        <div style="margin-bottom: 10px; font-size: 12px; color: #666; text-align: center;">
                            ⚡ Live attendance monitoring - ${liveData.length} employees
                        </div>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${liveData.map(emp => `
                                <div class="employee-card" style="margin-bottom: 8px; padding: 12px;">
                                    <div>
                                        <h4 style="margin-bottom: 3px;">🚀 ${emp.name}</h4>
                                        <p style="font-size: 12px; margin: 0;">${emp.department}</p>
                                    </div>
                                    <span class="status-badge ${emp.attendance && emp.attendance.length > 0 && emp.attendance[0].status === 'present' ? 'status-working' : 'status-out'}">
                                        ${emp.attendance && emp.attendance.length > 0 && emp.attendance[0].status === 'present' ? 
                                            '💼 Live Working' : 
                                            '🏠 Not In'}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    container.innerHTML = '<p style="text-align: center; color: #666; font-size: 12px;">No live attendance data</p>';
                }
                
            } catch (error) {
                console.error('Error loading live attendance:', error);
                container.innerHTML = '<p style="color: #e53e3e; font-size: 12px;">Error loading live data</p>';
            }
        }

        // 🚀 LIVE ATTENDANCE TRACKING
        function loadAttendance() {
            const today = new Date().toISOString().split('T')[0];
            const saved = localStorage.getItem(`live_attendance_${currentUser.id}_${today}`);
            if (saved) {
                attendanceData = JSON.parse(saved);
                if (attendanceData.checkInTime) {
                    attendanceData.checkInTime = new Date(attendanceData.checkInTime);
                }
                if (attendanceData.breakStart) {
                    attendanceData.breakStart = new Date(attendanceData.breakStart);
                }
            }
            updateAttendanceUI();
        }

        function saveAttendanceData() {
            if (attendanceData.isCheckedIn) {
                const today = new Date().toISOString().split('T')[0];
                localStorage.setItem(`live_attendance_${currentUser.id}_${today}`, JSON.stringify(attendanceData));
                console.log('💾 Live attendance data saved');
            }
        }

        async function checkIn() {
            try {
                const checkInTime = new Date();
                attendanceData.isCheckedIn = true;
                attendanceData.checkInTime = checkInTime;
                
                const { error } = await supabase
                    .from('attendance')
                    .upsert({
                        employee_id: currentUser.id,
                        date: new Date().toISOString().split('T')[0],
                        check_in: checkInTime.toTimeString().split(' ')[0],
                        status: 'present'
                    });

                if (error) throw error;
                
                saveAttendanceData();
                updateAttendanceUI();
                showNotification('Live check-in successful! 🚀⏰', 'success');
                
                // Trigger visual effect
                const attendanceCard = document.getElementById('attendanceCard');
                if (attendanceCard) {
                    attendanceCard.classList.add('updated');
                    setTimeout(() => attendanceCard.classList.remove('updated'), 2000);
                }
                
            } catch (error) {
                console.error('Check-in error:', error);
                showNotification('Live check-in failed ❌', 'error');
            }
        }

        async function checkOut() {
            try {
                if (!attendanceData.isCheckedIn) {
                    showNotification('You are not checked in! ⚠️', 'error');
                    return;
                }
                
                const checkOutTime = new Date();
                const totalMs = checkOutTime - attendanceData.checkInTime - attendanceData.totalBreakTime;
                const totalHours = Math.max(0, Math.round((totalMs / (1000 * 60 * 60)) * 100) / 100);
                
                const { error } = await supabase
                    .from('attendance')
                    .update({
                        check_out: checkOutTime.toTimeString().split(' ')[0],
                        total_hours: totalHours,
                        break_time: Math.round(attendanceData.totalBreakTime / (1000 * 60))
                    })
                    .eq('employee_id', currentUser.id)
                    .eq('date', new Date().toISOString().split('T')[0]);

                if (error) throw error;
                
                // Update UI first
                document.getElementById('checkOutTime').textContent = checkOutTime.toTimeString().substr(0, 5);
                
                // Clear attendance data - DON'T reset to checked in
                const today = new Date().toISOString().split('T')[0];
                localStorage.removeItem(`live_attendance_${currentUser.id}_${today}`);
                
                attendanceData = {
                    isCheckedIn: false,  // Make sure it's false
                    isOnBreak: false,
                    checkInTime: null,
                    breakStart: null,
                    totalBreakTime: 0
                };
                
                updateAttendanceUI();
                showNotification(`Live check-out successful! Worked ${totalHours.toFixed(1)}h 🏁🚀`, 'success');
                
                // Reload attendance to sync with database
                setTimeout(() => {
                    loadAttendance();
                }, 1000);
                
            } catch (error) {
                console.error('Check-out error:', error);
                showNotification('Live check-out failed ❌', 'error');
            }
        }

        // Fix handleAddTask function
        async function handleAddTask(e) {
            e.preventDefault();
            
            const subtasksText = document.getElementById('taskSubtasks').value;
            const subtasks = subtasksText
                .split('\n')
                .filter(task => task.trim())
                .map(task => ({ text: task.trim(), completed: false }));
            
            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value || null,
                priority: document.getElementById('taskPriority').value,
                due_date: document.getElementById('taskDueDate').value,
                assigned_to: document.getElementById('taskAssignTo').value,
                created_by: currentUser.id,
                status: 'pending',
                subtasks: subtasks.length > 0 ? JSON.stringify(subtasks) : null,
                progress: 0
            };
            
            // Validate required fields
            if (!taskData.title || !taskData.assigned_to || !taskData.due_date) {
                showNotification('Please fill all required fields! ⚠️', 'error');
                return;
            }
            
            try {
                console.log('Adding task:', taskData);
                
                const { data, error } = await supabase
                    .from('tasks')
                    .insert([taskData])
                    .select();

                if (error) {
                    console.error('Task error:', error);
                    throw error;
                }
                
                showNotification(`Live task assigned with ${subtasks.length} checklist items! 📝🚀`, 'success');
                closeModal('addTaskModal');
                e.target.reset();
                
            } catch (error) {
                console.error('Add task error:', error);
                if (error.message.includes('column') && error.message.includes('does not exist')) {
                    showNotification('Database structure issue! Please run SQL fixes first. ⚠️', 'error');
                } else {
                    showNotification(`Failed to assign task: ${error.message} ❌`, 'error');
                }
            }
        }

        // Fix handleApplyLeave function
        async function handleApplyLeave(e) {
            e.preventDefault();
            
            const fromDate = new Date(document.getElementById('leaveFromDate').value);
            const toDate = new Date(document.getElementById('leaveToDate').value);
            const days = Math.ceil((toDate - fromDate) / (1000 * 60 * 60 * 24)) + 1;
            
            const leaveData = {
                employee_id: currentUser.id,
                leave_type: document.getElementById('leaveType').value,
                from_date: document.getElementById('leaveFromDate').value,
                to_date: document.getElementById('leaveToDate').value,
                reason: document.getElementById('leaveReason').value,
                status: 'pending',
                days: days
            };
            
            // Validate required fields
            if (!leaveData.leave_type || !leaveData.from_date || !leaveData.to_date || !leaveData.reason) {
                showNotification('Please fill all required fields! ⚠️', 'error');
                return;
            }
            
            try {
                console.log('Adding leave request:', leaveData);
                
                const { data, error } = await supabase
                    .from('leave_requests')
                    .insert([leaveData])
                    .select();

                if (error) {
                    console.error('Leave error:', error);
                    throw error;
                }
                
                showNotification(`Live leave request submitted for ${days} day(s)! 🏖️🚀`, 'success');
                closeModal('applyLeaveModal');
                e.target.reset();
                
            } catch (error) {
                console.error('Apply leave error:', error);
                if (error.message.includes('column') && error.message.includes('does not exist')) {
                    showNotification('Database structure issue! Please run SQL fixes first. ⚠️', 'error');
                } else {
                    showNotification(`Failed to submit leave: ${error.message} ❌`, 'error');
                }
            }
        }

        // Fix handleCreateRoster function
        async function handleCreateRoster(e) {
            e.preventDefault();
            
            const rosterData = {
                employee_id: document.getElementById('rosterEmployee').value,
                date: document.getElementById('rosterDate').value,
                shift: document.getElementById('rosterShift').value,
                location: document.getElementById('rosterLocation').value,
                notes: document.getElementById('rosterNotes').value || null,
                created_by: currentUser.id
            };
            
            // Validate required fields
            if (!rosterData.employee_id || !rosterData.date || !rosterData.shift) {
                showNotification('Please fill all required fields! ⚠️', 'error');
                return;
            }
            
            try {
                console.log('Creating roster:', rosterData);
                
                const { data, error } = await supabase
                    .from('roster')
                    .upsert([rosterData])
                    .select();

                if (error) {
                    console.error('Roster error:', error);
                    throw error;
                }
                
                showNotification('Live employee schedule created! 📅🚀', 'success');
                closeModal('createRosterModal');
                e.target.reset();
                
            } catch (error) {
                console.error('Create roster error:', error);
                if (error.message.includes('column') && error.message.includes('does not exist')) {
                    showNotification('Database structure issue! Please run SQL fixes first. ⚠️', 'error');
                } else {
                    showNotification(`Failed to create schedule: ${error.message} ❌`, 'error');
                }
            }
        }

        // Enhanced loadAttendance function
        function loadAttendance() {
            const today = new Date().toISOString().split('T')[0];
            const saved = localStorage.getItem(`live_attendance_${currentUser.id}_${today}`);
            
            // Reset attendance data first
            attendanceData = {
                isCheckedIn: false,
                isOnBreak: false,
                checkInTime: null,
                breakStart: null,
                totalBreakTime: 0
            };
            
            if (saved) {
                try {
                    const parsedData = JSON.parse(saved);
                    attendanceData = { ...attendanceData, ...parsedData };
                    
                    if (attendanceData.checkInTime) {
                        attendanceData.checkInTime = new Date(attendanceData.checkInTime);
                    }
                    if (attendanceData.breakStart) {
                        attendanceData.breakStart = new Date(attendanceData.breakStart);
                    }
                } catch (error) {
                    console.error('Error parsing attendance data:', error);
                    localStorage.removeItem(`live_attendance_${currentUser.id}_${today}`);
                }
            }
            
            updateAttendanceUI();
            console.log('Attendance loaded:', attendanceData);
        }

        // Enhanced error handling for database operations
        async function executeWithErrorHandling(operation, operationName) {
            try {
                return await operation();
            } catch (error) {
                console.error(`${operationName} error:`, error);
                
                if (error.message.includes('column') && error.message.includes('does not exist')) {
                    showNotification(`Database structure issue in ${operationName}! Please run SQL fixes. ⚠️`, 'error');
                    
                    // Show detailed error in console
                    console.error('Missing column error. Please run these SQL commands in Supabase:');
                    console.error(`
-- Fix missing columns
ALTER TABLE leave_requests ADD COLUMN IF NOT EXISTS days INTEGER;
ALTER TABLE tasks ADD COLUMN IF NOT EXISTS subtasks TEXT;
ALTER TABLE tasks ADD COLUMN IF NOT EXISTS progress INTEGER DEFAULT 0;
ALTER TABLE tasks ADD COLUMN IF NOT EXISTS created_by UUID;
ALTER TABLE attendance ADD COLUMN IF NOT EXISTS break_time INTEGER DEFAULT 0;
ALTER TABLE attendance ADD COLUMN IF NOT EXISTS total_hours DECIMAL(4,2) DEFAULT 0;
ALTER TABLE roster ADD COLUMN IF NOT EXISTS created_by UUID;
ALTER TABLE roster ADD COLUMN IF NOT EXISTS notes TEXT;
                    `);
                } else {
                    showNotification(`${operationName} failed: ${error.message} ❌`, 'error');
                }
                
                throw error;
            }
        }

        // Add database structure check function
        async function checkDatabaseStructure() {
            try {
                console.log('🔍 Checking database structure...');
                
                // Test if all required columns exist
                const tests = [
                    { table: 'employees', data: { name: 'test', email: 'test@test.com', password: 'test123' } },
                    { table: 'tasks', data: { title: 'test', assigned_to: currentUser.id, created_by: currentUser.id, subtasks: '[]', progress: 0 } },
                    { table: 'leave_requests', data: { employee_id: currentUser.id, leave_type: 'casual', from_date: '2024-01-01', to_date: '2024-01-01', reason: 'test', status: 'pending', days: 1 } },
                    { table: 'roster', data: { employee_id: currentUser.id, date: '2024-01-01', shift: 'morning', location: 'office', created_by: currentUser.id, notes: 'test' } },
                    { table: 'attendance', data: { employee_id: currentUser.id, date: '2024-01-01', status: 'present', total_hours: 8.0, break_time: 30 } }
                ];
                
                for (const test of tests) {
                    try {
                        // Try to insert and immediately delete (to test structure)
                        const { data, error } = await supabase
                            .from(test.table)
                            .insert([test.data])
                            .select();
                        
                        if (data && data[0]) {
                            await supabase
                                .from(test.table)
                                .delete()
                                .eq('id', data[0].id);
                        }
                        
                        if (error) throw error;
                        console.log(`✅ ${test.table} structure OK`);
                        
                    } catch (error) {
                        console.error(`❌ ${test.table} structure issue:`, error.message);
                        showNotification(`Database structure issue in ${test.table}! ⚠️`, 'error');
                    }
                }
                
            } catch (error) {
                console.error('Database structure check failed:', error);
            }
        }

        function toggleBreak() {
            if (!attendanceData.isCheckedIn) return;
            
            if (attendanceData.isOnBreak) {
                const breakDuration = new Date() - attendanceData.breakStart;
                attendanceData.totalBreakTime += breakDuration;
                attendanceData.isOnBreak = false;
                attendanceData.breakStart = null;
                showNotification('Live break ended ⏰🚀', 'info');
            } else {
                attendanceData.isOnBreak = true;
                attendanceData.breakStart = new Date();
                showNotification('Live break started ☕🚀', 'info');
            }
            
            saveAttendanceData();
            updateAttendanceUI();
        }

        function updateAttendanceUI() {
            const checkInBtn = document.getElementById('checkInBtn');
            const checkOutBtn = document.getElementById('checkOutBtn');
            const breakBtn = document.getElementById('breakBtn');
            const status = document.getElementById('attendanceStatus');
            const checkInTimeEl = document.getElementById('checkInTime');
            
            if (!checkInBtn || !checkOutBtn || !breakBtn || !status || !checkInTimeEl) return;
            
            checkInBtn.disabled = attendanceData.isCheckedIn;
            checkOutBtn.disabled = !attendanceData.isCheckedIn;
            breakBtn.disabled = !attendanceData.isCheckedIn;
            
            if (attendanceData.isCheckedIn) {
                checkInBtn.textContent = '✅ Live Checked In';
                breakBtn.textContent = attendanceData.isOnBreak ? '⏰ End Break' : '☕ Start Break';
                
                if (attendanceData.isOnBreak) {
                    status.className = 'status-badge status-break';
                    status.textContent = '☕ Live Break';
                } else {
                    status.className = 'status-badge status-working';
                    status.textContent = '💼 Live Working';
                }
            } else {
                checkInBtn.textContent = '🚀 Live Check In';
                breakBtn.textContent = '☕ Break';
                status.className = 'status-badge status-out';
                status.textContent = '🏠 Not Checked In';
            }
            
            if (attendanceData.checkInTime) {
                checkInTimeEl.textContent = attendanceData.checkInTime.toTimeString().substr(0, 5);
            } else {
                checkInTimeEl.textContent = '--:--';
            }
        }

        function updateWorkingTime() {
            if (attendanceData.isCheckedIn && attendanceData.checkInTime) {
                const now = new Date();
                let workingMs = now - attendanceData.checkInTime - attendanceData.totalBreakTime;
                
                if (attendanceData.isOnBreak && attendanceData.breakStart) {
                    const currentBreakMs = now - attendanceData.breakStart;
                    workingMs -= currentBreakMs;
                }
                
                const hours = Math.floor(workingMs / (1000 * 60 * 60));
                const minutes = Math.floor((workingMs % (1000 * 60 * 60)) / (1000 * 60));
                
                const timeStr = `${hours}h ${minutes}m`;
                updateStatCard('todayHours', timeStr);
                
                const workingTimeEl = document.getElementById('workingTime');
                if (workingTimeEl) {
                    workingTimeEl.textContent = timeStr;
                    // Add live update effect
                    const timeItem = workingTimeEl.closest('.time-item');
                    if (timeItem) {
                        timeItem.classList.add('updating');
                        setTimeout(() => timeItem.classList.remove('updating'), 500);
                    }
                }
                
                // Update break time
                let totalBreakMs = attendanceData.totalBreakTime;
                if (attendanceData.isOnBreak && attendanceData.breakStart) {
                    totalBreakMs += (now - attendanceData.breakStart);
                }
                const breakHours = Math.floor(totalBreakMs / (1000 * 60 * 60));
                const breakMinutes = Math.floor((totalBreakMs % (1000 * 60 * 60)) / (1000 * 60));
                
                const breakTimeEl = document.getElementById('breakTime');
                if (breakTimeEl) {
                    breakTimeEl.textContent = `${breakHours}h ${breakMinutes}m`;
                }
            }
        }

        // 🎯 UTILITY FUNCTIONS
        function updateStatCard(cardId, value) {
            const card = document.getElementById(cardId);
            if (card) {
                card.textContent = value;
                // Add live update animation
                const statCard = card.closest('.stat-card');
                if (statCard) {
                    statCard.classList.add('updating');
                    setTimeout(() => statCard.classList.remove('updating'), 1000);
                }
            }
        }

        function updateOnlineUsersCount(count) {
            // Update online users display
            const realtimeStatus = document.getElementById('realtimeStatus');
            if (realtimeStatus && count > 1) {
                const connectionInfo = realtimeStatus.querySelector('.connection-info');
                if (connectionInfo) {
                    connectionInfo.innerHTML += `<div style="font-size: 10px;">👥 ${count} users online</div>`;
                }
            }
        }

        function forceLiveUpdate() {
            if (currentUser && realtimeChannelCount >= 3) {
                console.log('🔄 Force live update triggered');
                loadAllData();
                showNotification('Live data synchronized! 🔄🚀', 'info', 2000);
            }
        }

        function triggerSystemUpdate() {
            showNotification('Forcing live sync across all systems... 🔄🚀', 'info');
            setTimeout(() => {
                forceLiveUpdate();
                showNotification('All live systems synchronized! ✅🚀', 'success');
            }, 1000);
        }

        function getPriorityIcon(priority) {
            switch(priority) {
                case 'urgent': return '🚨';
                case 'high': return '🔴';
                case 'medium': return '🟡';
                case 'low': return '🟢';
                default: return '⚪';
            }
        }

        function getShiftTime(shift) {
            switch(shift) {
                case 'morning': return '🕘 9:00 AM - 6:00 PM';
                case 'evening': return '🕐 2:00 PM - 11:00 PM';
                case 'night': return '🕚 11:00 PM - 8:00 AM';
                case 'half': return '🕐 9:00 AM - 1:00 PM';
                case 'off': return '🏠 Day Off';
                default: return '🕘 9:00 AM - 6:00 PM';
            }
        }

        function getShiftIcon(shift) {
            switch(shift) {
                case 'morning': return '🌅';
                case 'evening': return '🌆';
                case 'night': return '🌙';
                case 'half': return '🕐';
                case 'off': return '🏠';
                default: return '🌅';
            }
        }

        function getLocationIcon(location) {
            switch(location) {
                case 'office': return '🏢';
                case 'remote': return '🏠';
                case 'hybrid': return '🔄';
                case 'field': return '🚗';
                default: return '🏢';
            }
        }

        function getLeaveStatusClass(status) {
            switch(status) {
                case 'approved': return 'status-working';
                case 'rejected': return 'status-out';
                case 'pending': return 'status-break';
                default: return 'status-break';
            }
        }

        function getLeaveStatusIcon(status) {
            switch(status) {
                case 'approved': return '✅';
                case 'rejected': return '❌';
                case 'pending': return '⏳';
                default: return '⏳';
            }
        }

        function calculateLeaveDays(fromDate, toDate) {
            const start = new Date(fromDate);
            const end = new Date(toDate);
            const diffTime = Math.abs(end - start);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
        }

        function showLoading(textElementId, loaderElementId) {
            const textEl = document.getElementById(textElementId);
            const loaderEl = document.getElementById(loaderElementId);
            if (textEl) textEl.style.display = 'none';
            if (loaderEl) loaderEl.style.display = 'inline-block';
        }

        function hideLoading(textElementId, loaderElementId) {
            const textEl = document.getElementById(textElementId);
            const loaderEl = document.getElementById(loaderElementId);
            if (textEl) textEl.style.display = 'inline';
            if (loaderEl) loaderEl.style.display = 'none';
        }

        // 🎯 MODAL FUNCTIONS
        function openAddEmployeeModal() {
            document.getElementById('addEmployeeModal').classList.add('show');
        }

        function openAddTaskModal() {
            document.getElementById('addTaskModal').classList.add('show');
            updateEmployeeDropdowns();
        }

        function openCreateRosterModal() {
            document.getElementById('createRosterModal').classList.add('show');
            updateEmployeeDropdowns();
        }

        function openApplyLeaveModal() {
            document.getElementById('applyLeaveModal').classList.add('show');
        }

        function openHolidayModal() {
            showNotification('Live holiday management coming soon! 🎉🚀', 'info');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // 🎯 EVENT LISTENERS
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.show').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
        });

        // 🚀 ADVANCED REAL-TIME FEATURES
        window.addEventListener('online', function() {
            showNotification('Live connection restored! Syncing... 🌐🚀', 'success');
            setTimeout(() => {
                initializeRealtimeSystem();
                loadAllData();
            }, 1000);
        });

        window.addEventListener('offline', function() {
            showNotification('Connection lost! Working in offline mode 📱', 'error');
            cleanupRealtimeSubscriptions();
        });

        window.addEventListener('beforeunload', function() {
            cleanupRealtimeSubscriptions();
            saveAttendanceData();
        });

        // 🚀 SYSTEM MONITORING
        window.addEventListener('load', function() {
            setTimeout(function() {
                if ('performance' in window) {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    console.log('🚀 Live system load time:', Math.round(perfData.loadEventEnd - perfData.loadEventStart), 'ms');
                }
            }, 100);
        });

        // 🚀 EXPORT FOR DEBUGGING
        window.liveEmployeePortal = {
            currentUser,
            attendanceData,
            realtimeSubscriptions,
            realtimeChannelCount,
            updateCounters,
            supabase,
            version: '5.0.0-LIVE-REALTIME-SYSTEM'
        };

        // 🚀 FINAL CONSOLE MESSAGE
        console.log(`
🚀 LIVE REAL-TIME EMPLOYEE MANAGEMENT PORTAL v5.0.0
✅ COMPLETE FEATURES:
   • 🔐 Full password authentication system
   • 📋 Live task management with real-time checklists
   • 👥 Live employee management with instant updates
   • 📅 Live schedule and roster management
   • 🏖️ Live leave management system
   • ⏰ Real-time attendance tracking
   • 🔄 Complete live data synchronization
   • 📱 Responsive design for all devices
   • ⚡ 5-channel real-time system
   
🔐 LOGIN SYSTEM:
   • Email + Password authentication
   • Admin can add employees with login credentials
   • Live password reset functionality
   
📋 LIVE TASK SYSTEM:
   • Tasks with interactive real-time checklists
   • Live progress tracking (0-100%)
   • Priority levels with live alerts
   • Real-time status updates across all users
   
👨‍💼 LIVE ADMIN FEATURES:
   • Add/remove employees with live updates
   • Assign tasks with live checklists
   • Create live schedules and rosters
   • Approve/reject leave requests in real-time
   • Live attendance monitoring
   
⚡ REAL-TIME FEATURES:
   • 5-channel live data synchronization
   • Instant notifications for all updates
   • Live user presence monitoring
   • Auto-reconnect and backup systems
   • Visual live update animations
   
🚀 PRODUCTION READY WITH COMPLETE LIVE SYSTEM!
        `);

        console.log('🎉 LIVE REAL-TIME EMPLOYEE PORTAL - FULLY OPERATIONAL! 🚀');
    </script>
</body>
</html>
